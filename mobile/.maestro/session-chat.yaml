appId: com.subroutine.workspace
---
# Test: Session Chat Screen
# Verifies the chat screen UI elements and basic interactions

- launchApp:
    clearState: true

# Wait for app to fully load
- extendedWaitUntil:
    visible: "Workspaces"
    timeout: 10000

# Handle case when no workspaces exist
- runFlow:
    when:
      visible: "No workspaces yet"
    commands:
      - assertVisible: "Tap + to create one"

# Navigate to a workspace when they exist
- runFlow:
    when:
      visible: "Details"
    commands:
      - tapOn: "Details"

      # Should see workspace detail screen
      - extendedWaitUntil:
          visible: "Sessions"
          timeout: 5000

      # Tap on the new chat button
      - tapOn:
          id: "new-chat-button"

      # Should see the agent picker
      - extendedWaitUntil:
          visible: "Claude Code"
          timeout: 3000

      # Select Claude Code agent
      - tapOn:
          id: "new-chat-claude-code"

      # Should now be in the chat screen - verify input field exists
      - extendedWaitUntil:
          id: "chat-input"
          timeout: 5000

      # Verify send button exists and is initially disabled (no text)
      - assertVisible:
          id: "send-button"

      # Type a test message
      - tapOn:
          id: "chat-input"
      - inputText: "Hello, this is a test message"

      # Handle connected vs disconnected states
      - runFlow:
          when:
            visible:
              id: "send-button"
          commands:
            # If connected, we can send the message
            - tapOn:
                id: "send-button"

            # Message should appear as user message
            - extendedWaitUntil:
                id: "user-message"
                timeout: 3000

            # May see thinking dots if streaming
            - runFlow:
                when:
                  visible:
                    id: "thinking-dots"
                commands:
                  # If we see thinking dots, stop button should be visible
                  - assertVisible:
                      id: "stop-button"

      # Handle error state (connection failed)
      - runFlow:
          when:
            visible: "Connection error"
          commands:
            # This is expected when agent isn't running
            - assertVisible: "Connection error"

      # Navigate back
      - tapOn: "â€¹"

      # Should return to workspace detail
      - assertVisible: "Sessions"
